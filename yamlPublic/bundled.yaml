openapi: 3.1.0
info:
  title: Library API
  version: 1.0.0
servers:
  - url: http://localhost:3000
    description: local development server
  - url: https://library-api-hvyv.onrender.com
    description: Production server on render
tags:
  - name: Library
    description: Library-related endpoints
paths:
  /employees:
    get:
      summary: list all employees
      tags:
        - Employee
      parameters:
        - name: role
          in: query
          required: false
          description: filter employees by role
          schema:
            type: string
            enum:
              - LIBRARIAN
              - MANAGER
            example: MANAGER
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Employee'
  /employees/{id}:
    get:
      summary: get employee by ID
      tags:
        - Employee
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the employee to retrieve
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Employee'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: update existing employee by Id
      tags:
        - Employee
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the employee to update
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Employee'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete employee by id
      tags:
        - Employee
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the employee to delete
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Employee deleted successfully (no content)
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
  /employees/me:
    get:
      summary: Get current employee profile
      tags:
        - Employee
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  name:
                    type: string
                    example: Steve Jobs
                  role:
                    type: string
                    enum:
                      - LIBRARIAN
                      - MANAGER
                    example: MANAGER
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
    put:
      summary: Update current employee profile
      tags:
        - Employee
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Steve Jobs Updated
                password:
                  type: string
                  example: newpassword123
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  name:
                    type: string
                    example: Steve Jobs Updated
                  role:
                    type: string
                    example: MANAGER
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /employees/register:
    post:
      summary: Register a new employee
      tags:
        - Employee
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - password
                - role
              properties:
                name:
                  type: string
                  example: John Doe
                password:
                  type: string
                  format: password
                  example: password123
                role:
                  type: string
                  enum:
                    - LIBRARIAN
                    - MANAGER
                  example: LIBRARIAN
      responses:
        '201':
          description: Employee registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  name:
                    type: string
                    example: John Doe
                  role:
                    type: string
                    example: LIBRARIAN
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Employee with this name already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Employee with this name already exists
  /author:
    get:
      summary: list all authors
      tags:
        - Author
      parameters:
        - name: completed
          in: query
          required: false
          description: filter authors by completion status
          schema:
            type: boolean
            example: true
        - name: limit
          in: query
          required: false
          description: maximum number of authors to return
          schema:
            type: integer
            example: 10
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Author'
    post:
      summary: create a new author
      tags:
        - Author
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Author'
      responses:
        '201':
          description: author created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Author'
        '400':
          $ref: '#/components/responses/BadRequest'
  /author/{id}:
    get:
      summary: get author by ID
      tags:
        - Author
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the author to retrieve
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: null
              type: array
              items:
                $ref: ../../components/schemas/Author.yaml
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: update existing author by Id
      tags:
        - Author
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the author to update
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Author'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete author by id
      tags:
        - Author
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the author to delete
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Author'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
  /author/{id}/books:
    get:
      summary: Get all books by a specific author
      tags:
        - Author
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the author
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    title:
                      type: string
                      example: We Hunt the Flame
                    authorId:
                      type: integer
                      example: 1
                    genreId:
                      type: integer
                      example: 1
                    price:
                      type: number
                      format: float
                      example: 20
                    stock:
                      type: integer
                      example: 2
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
  /book:
    get:
      summary: list all books
      tags:
        - Book
      parameters:
        - name: completed
          in: query
          required: false
          description: filter books by completion status
          schema:
            type: boolean
            example: true
        - name: limit
          in: query
          required: false
          description: maximum number of books to return
          schema:
            type: integer
            example: 10
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Book'
    post:
      summary: create a new book
      tags:
        - Book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Book'
      responses:
        '201':
          description: book created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          $ref: '#/components/responses/BadRequest'
  /book/{id}:
    get:
      summary: get book by ID
      tags:
        - Book
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the book to retrieve
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: update existing book by Id
      tags:
        - Book
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the book to update
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete book by id
      tags:
        - Book
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the book to delete
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
  /genre:
    get:
      summary: list all genres
      tags:
        - Genre
      parameters:
        - name: completed
          in: query
          required: false
          description: filter genres by completion status
          schema:
            type: boolean
            example: true
        - name: limit
          in: query
          required: false
          description: maximum number of genres to return
          schema:
            type: integer
            example: 10
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Genre'
    post:
      summary: create a new genre
      tags:
        - Genre
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Genre'
      responses:
        '201':
          description: genre created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Genre'
        '400':
          $ref: '#/components/responses/BadRequest'
  /genre/{id}:
    get:
      summary: get genre by ID
      tags:
        - Genre
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the genre to retrieve
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: null
              type: array
              items:
                $ref: ../../components/schemas/Genre.yaml
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: update existing genre by Id
      tags:
        - Genre
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the genre to update
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Genre'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete genre by id
      tags:
        - Genre
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the genre to delete
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Genre'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
  /genre/{id}/books:
    get:
      summary: Get all books in a specific genre
      tags:
        - Genre
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the genre
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        title:
                          type: string
                          example: We Hunt the Flame
                        authorId:
                          type: integer
                          example: 1
                        price:
                          type: number
                          format: float
                          example: 20
                        stock:
                          type: integer
                          example: 2
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
components:
  schemas:
    Employee:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
          description: Unique identifier for the employee
        name:
          type: string
          minLength: 2
          maxLength: 100
          example: Steve Jobs
          description: Employee's full name (must be unique)
        role:
          type: string
          enum:
            - LIBRARIAN
            - MANAGER
          example: MANAGER
          description: Role of the employee in the library system
        password:
          type: string
          writeOnly: true
          format: password
          minLength: 6
          example: password123
          description: Employee's password (only used for registration/update, never returned)
      required:
        - name
        - role
    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: Validation failed
        details:
          type: array
          items:
            type: string
    NotFoundError:
      type: object
      properties:
        error:
          type: string
          example: Task not found
    UnauthorizedError:
      type: object
      properties:
        error:
          type: string
          example: Unauthorized
    Author:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
          description: Unique identifier for the author
        firstName:
          type: string
          minLength: 2
          maxLength: 50
          example: Hafsah
          description: Author's first name
        lastName:
          type: string
          minLength: 2
          maxLength: 50
          example: Faizal
          description: Author's last name
        books:
          type: array
          readOnly: true
          items:
            type: object
            properties:
              id:
                type: integer
              title:
                type: string
              authorId:
                type: integer
              genreId:
                type: integer
              price:
                type: number
              stock:
                type: integer
          description: List of books by this author (only included in certain endpoints)
      required:
        - firstName
        - lastName
    Book:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
          description: Unique identifier for the book
        title:
          type: string
          minLength: 1
          maxLength: 50
          example: We Hunt the Flame
          description: Title of the book
        authorId:
          type: integer
          example: 1
          description: ID of the author who wrote the book
        genreId:
          type: integer
          example: 1
          description: ID of the genre the book belongs to
        price:
          type: number
          format: float
          minimum: 0
          example: 20
          description: Price of the book
        stock:
          type: integer
          minimum: 0
          example: 2
          description: Number of copies available in stock
        author:
          type: object
          readOnly: true
          properties:
            id:
              type: integer
            firstName:
              type: string
            lastName:
              type: string
          description: Author information (only included in certain endpoints)
        genre:
          type: object
          readOnly: true
          properties:
            id:
              type: integer
            name:
              type: string
          description: Genre information (only included in certain endpoints)
      required:
        - title
        - authorId
        - genreId
        - price
        - stock
    Genre:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
          description: Unique identifier for the genre
        name:
          type: string
          minLength: 2
          maxLength: 50
          example: Fantasy
          description: Name of the genre (must be unique)
        books:
          type: array
          readOnly: true
          items:
            type: object
            properties:
              id:
                type: integer
              title:
                type: string
              authorId:
                type: integer
              price:
                type: number
              stock:
                type: integer
          description: List of books in this genre (only included in certain endpoints)
      required:
        - name
  responses:
    BadRequest:
      description: Invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NotFoundError'
    Unauthorized:
      description: Unauthorized - Invalid or missing authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UnauthorizedError'
